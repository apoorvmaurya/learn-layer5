syntax = "proto3";
import "google/protobuf/empty.proto";
import "service-mesh-performance/common/error.proto";
import "service-mesh-performance/controller/health.proto";
import "service-mesh-performance/controller/info.proto";
import "service-mesh-performance/protos/service_mesh.proto";

package smi_conformance;
option go_package = "conformance;conformance";

enum Capability {
    FULL = 0;
    HALF = 1;
    NONE = 2;
}

enum TestStatus {
    COMPLETED = 0;
    INPROGRESS = 1;
    CRASHED = 2;
}

enum ResultStatus {
    PASSED = 0;
    FAILED = 1;
}

message Request {
    smp.ServiceMesh mesh = 1;
}

message Result {
  oneof result {
    string message = 1;
    common.CommonError error = 2;
  }
}

message Detail {
    string smispec = 1;
    string specversion = 2;
    string assertion = 3;
    string duration = 4;
    Result result = 5;
    ResultStatus status = 6;
}

message Response {
    string passpercent = 1;
    string casespassed = 2;
    smp.ServiceMesh mesh = 3;
    Capability capability = 4;
    repeated Detail details = 5;
}

service conformanceTesting{
    rpc Info (google.protobuf.Empty) returns (controller.ControllerInfo);
    rpc Health (google.protobuf.Empty) returns (controller.ControllerHealth);
    rpc RunTest (Request) returns (Response);
}